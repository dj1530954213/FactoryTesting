# FAT_TEST 系统架构设计

## 架构概述

FAT_TEST 采用分层架构设计，基于 Rust + Angular + Tauri 技术栈，实现了前后端分离的桌面应用程序。

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Angular 前端层                           │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   组件层    │ │   服务层    │ │   状态管理  │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │
                         Tauri IPC
                              │
┌─────────────────────────────────────────────────────────────┐
│                    Rust 后端层                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │   应用层    │ │   领域层    │ │ 基础设施层  │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
                              │
                              │
┌─────────────────────────────────────────────────────────────┐
│                    外部系统                                 │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │  PLC 设备   │ │  数据库     │ │  文件系统   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
```

## 后端架构

### 分层设计

1. **应用层 (Application Layer)**
   - 编排业务用例
   - 协调领域服务
   - 处理 Tauri 命令

2. **领域层 (Domain Layer)**
   - 核心业务逻辑
   - 状态管理
   - 测试执行引擎

3. **基础设施层 (Infrastructure Layer)**
   - PLC 通信
   - 数据持久化
   - Excel 处理

### 核心组件

- **ChannelStateManager**: 通道状态管理器，唯一的状态修改点
- **TestExecutionEngine**: 测试执行引擎，处理并发控制
- **PLCCommunicationService**: PLC 通信服务接口
- **PersistenceService**: 数据持久化服务接口

## 前端架构

### 组件结构

- **共享组件**: 可复用的UI组件
- **页面组件**: 具体功能页面
- **服务层**: 封装后端通信和状态管理

### 数据流

1. 用户操作触发组件事件
2. 组件调用服务层方法
3. 服务层通过 Tauri IPC 调用后端
4. 后端处理业务逻辑并返回结果
5. 前端更新UI状态

## 通信机制

### Tauri IPC

- **Commands**: 前端调用后端的同步/异步方法
- **Events**: 后端向前端推送实时数据

### 数据模型

- 前后端共享数据模型定义
- TypeScript 接口对应 Rust 结构体
- 自动序列化/反序列化

## 设计原则

1. **单一职责**: 每个模块职责明确
2. **依赖倒置**: 通过接口抽象实现松耦合
3. **分层架构**: 清晰的分层结构
4. **领域驱动**: 核心业务逻辑集中在领域层

## 扩展性

- 支持多种 PLC 协议
- 可插拔的持久化方案
- 模块化的测试执行器
- 国际化支持 