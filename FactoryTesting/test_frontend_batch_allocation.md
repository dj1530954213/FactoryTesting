# 前端批次分配功能测试指南

## 问题诊断
用户反馈：
1. 依然只能获取到一个批次信息
2. 后端在进行批次分配时没有显示任何日志
3. 日志可能没有组态或前端调用方法不对

## 修复内容
1. **日志系统初始化** - 在 `lib.rs` 中添加了 `env_logger` 初始化
2. **创建测试数据命令** - 添加了 `create_test_data` 命令用于生成测试通道
3. **前端调试工具** - 添加了"创建测试数据"按钮

## 测试步骤

### 1. 启动应用
```bash
npm run tauri dev
```

**预期结果**: 
- 控制台应该显示：
```
=== FAT_TEST 工厂测试系统启动 ===
日志系统已初始化，级别: DEBUG
开始初始化应用状态...
应用状态初始化成功
```

### 2. 访问测试执行页面
- 打开浏览器访问应用
- 点击"测试执行"页面

### 3. 创建测试数据
- 点击"创建测试数据"按钮

**预期结果**:
- 控制台应该显示创建过程的详细日志
- 前端应该显示成功消息
- 应该创建20个通道定义（AI有源4个、AO无源4个、DI有源4个、DO无源4个、AI无源4个）

### 4. 提交测试批次
- 点击"创建并提交测试"按钮

**预期结果**:
- 控制台应该显示详细的批次分配日志
- 应该生成多个批次（而不是只有1个）
- 前端应该显示所有生成的批次信息

## 日志检查要点

### 后端日志
应该能看到以下关键日志：
```
[CreateTestData] 开始创建测试数据
[CreateTestData] 创建了 20 个测试通道定义
[TestCoordination] 提交测试执行请求: 批次 xxx, 20 个通道
[TestCoordination] 开始使用通道分配服务分配通道
[ChannelAllocation] 开始分配通道: 20个定义
[ChannelAllocation] 通道分配完成: X 个批次, Y 个实例
```

### 前端日志
应该能看到以下操作日志：
```
开始创建测试数据...
成功创建了 20 个测试通道定义
  AI: 4 个通道
  AO: 4 个通道
  DI: 4 个通道
  DO: 4 个通道
  AINone: 4 个通道
```

## 问题排查

### 如果没有看到后端日志
1. 检查日志级别设置是否正确
2. 确认 `env_logger` 依赖已安装
3. 检查 Tauri 控制台输出

### 如果依然只生成1个批次
1. 确认测试数据是否正确创建
2. 检查通道分配服务是否被正确调用
3. 验证通道类型分组逻辑

### 如果前端没有响应
1. 检查浏览器控制台是否有错误
2. 确认 Tauri 命令是否正确注册
3. 验证前端和后端的接口是否匹配

## 预期最终结果
- 生成3个批次（基于8个通道每批次的配置）
- 每个批次包含适当数量的通道实例
- 详细的日志输出显示整个分配过程
- 前端正确显示所有批次信息

## 调试命令
如果需要手动验证后端功能：
```bash
cd src-tauri
cargo test test_multiple_batch_allocation -- --nocapture
``` 