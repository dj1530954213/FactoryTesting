# FactoryTesting æ—¥å¿—ç³»ç»Ÿç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ

## æ¦‚è¿°

FactoryTesting é¡¹ç›®é‡‡ç”¨äº†å…¨æ–°çš„ä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿï¼Œç»è¿‡ç¬¬å››é˜¶æ®µQAä¸“å®¶éªŒè¯ï¼Œå·²å®Œå…¨è§£å†³äº†åŸæœ‰çš„"å£³å®ç°"é—®é¢˜ã€‚æœ¬ç³»ç»Ÿæä¾›å®Œæ•´çš„æ—¥å¿—è®°å½•ã€æ–‡ä»¶ç®¡ç†ã€è½®è½¬æ¸…ç†å’Œæ€§èƒ½ä¼˜åŒ–åŠŸèƒ½ã€‚

### ç³»ç»Ÿç‰¹æ€§

- âœ… **çœŸæ­£çš„Loggerå®ç°**: å®Œæ•´å®ç°äº† `log::Log` trait
- âœ… **4ç±»æ ¸å¿ƒå®ç³»ç»Ÿ**: ä¸“é—¨é’ˆå¯¹å·¥å‚æµ‹è¯•ä¸šåŠ¡çš„åˆ†ç±»æ—¥å¿—
- âœ… **æŒ‰æ—¥æœŸç»„ç»‡æ–‡ä»¶**: `logs/2024-01-15/` ç›®å½•ç»“æ„
- âœ… **æ™ºèƒ½è½®è½¬æœºåˆ¶**: åŸºäºå¤§å°å’Œæ—¶é—´çš„æ–‡ä»¶è½®è½¬
- âœ… **è‡ªåŠ¨æ¸…ç†åŠŸèƒ½**: 90å¤©ä¿ç•™æœŸï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ–‡ä»¶
- âœ… **å¼‚æ­¥å¤„ç†**: ä¸é˜»å¡ä¸»çº¿ç¨‹çš„é«˜æ€§èƒ½æ—¥å¿—å†™å…¥
- âœ… **å¹¶å‘å®‰å…¨**: æ”¯æŒå¤šçº¿ç¨‹å®‰å…¨è®¿é—®

### é€‚ç”¨åœºæ™¯

- å·¥å‚ç”Ÿäº§æµ‹è¯•ç³»ç»Ÿ
- PLCè®¾å¤‡é€šè®¯ç›‘æ§
- æµ‹è¯•æ•°æ®å¯¼å…¥å¯¼å‡º
- ç”¨æˆ·æ“ä½œå®¡è®¡è¿½è¸ª
- ç³»ç»Ÿæ•…éšœæ’æŸ¥åˆ†æ

---

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬åˆå§‹åŒ–

```rust
use crate::logging::{EnterpriseLoggerBuilder, LogLevel, LogFormat};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»ºä¼ä¸šçº§æ—¥å¿—ç³»ç»Ÿ
    let mut logger = EnterpriseLoggerBuilder::new()
        .level(LogLevel::Info)                // è®¾ç½®æ—¥å¿—çº§åˆ«
        .base_dir("logs")                    // æ—¥å¿—åŸºç¡€ç›®å½•
        .file_prefix("factory_test")         // æ–‡ä»¶åå‰ç¼€
        .format(LogFormat::Structured)        // ç»“æ„åŒ–æ ¼å¼
        .max_file_size_mb(50)               // æœ€å¤§æ–‡ä»¶å¤§å°
        .max_files(10)                      // ä¿ç•™æ–‡ä»¶æ•°é‡
        .retention_days(90)                 // ä¿ç•™90å¤©
        .compress_rotated(true)             // å‹ç¼©æ—§æ–‡ä»¶
        .async_processing(true)             // å¼‚æ­¥å¤„ç†
        .auto_cleanup(true)                 // è‡ªåŠ¨æ¸…ç†
        .build();
    
    // åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    logger.initialize().await?;
    
    // ç°åœ¨å¯ä»¥ä½¿ç”¨æ ‡å‡†æ—¥å¿—å®
    log::info!("ç³»ç»Ÿå¯åŠ¨å®Œæˆ");
    
    Ok(())
}
```

### 2. ä½¿ç”¨å…¨å±€æ—¥å¿—ç³»ç»Ÿ

```rust
use crate::logging::{EnterpriseLoggerBuilder, GlobalEnterpriseLogger};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»ºé…ç½®
    let config = EnterpriseLoggerBuilder::new()
        .base_dir("logs")
        .file_prefix("factory_test")
        .build()
        .get_config()
        .clone();
    
    // åˆå§‹åŒ–å…¨å±€æ—¥å¿—ç³»ç»Ÿ
    GlobalEnterpriseLogger::initialize(config).await?;
    
    // åœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨
    log::info!("åº”ç”¨åˆå§‹åŒ–å®Œæˆ");
    log::warn!("é…ç½®æ–‡ä»¶ä½¿ç”¨é»˜è®¤å€¼");
    
    Ok(())
}
```

---

## 4ç±»æ ¸å¿ƒå®ä½¿ç”¨æŒ‡å—

æœ¬æ—¥å¿—ç³»ç»Ÿä¸“é—¨ä¸ºå·¥å‚æµ‹è¯•ä¸šåŠ¡è®¾è®¡äº†4ç±»æ ¸å¿ƒé—®é¢˜æ—¥å¿—å®ï¼Œæ¯ä¸ªå®éƒ½ä¼šäº§ç”ŸåŒé‡è¾“å‡ºï¼ˆæ§åˆ¶å°+æ–‡ä»¶ï¼‰ï¼Œç¡®ä¿æ—¥å¿—å¯è§æ€§ã€‚

### 1. é€šè®¯å¤±è´¥æ—¥å¿— - `log_communication_failure!`

**ç”¨é€”**: è®°å½•PLCé€šè®¯ã€ç½‘ç»œè¿æ¥ç­‰é€šè®¯ç›¸å…³çš„å¤±è´¥

```rust
// åŸºæœ¬ç”¨æ³•
log_communication_failure!("PLCè®¾å¤‡è¿æ¥è¶…æ—¶");

// å¸¦å‚æ•°
log_communication_failure!("è®¾å¤‡{}è¿æ¥å¤±è´¥ï¼Œé”™è¯¯ä»£ç : {}", device_id, error_code);

// å¤æ‚åœºæ™¯
log_communication_failure!("ç½‘ç»œè¯·æ±‚è¶…æ—¶: {}ms > æœ€å¤§è¶…æ—¶{}ms", actual_time, max_timeout);
```

**è¾“å‡ºæ•ˆæœ**:
```
[2024-01-10 12:34:56.789] [ERROR] [é€šè®¯å¤±è´¥] [src/main.rs:42] - PLCè®¾å¤‡è¿æ¥è¶…æ—¶
```

### 2. æ–‡ä»¶è§£æå¤±è´¥æ—¥å¿— - `log_file_parsing_failure!`

**ç”¨é€”**: è®°å½•å¯¼å…¥ã€å¯¼å‡ºæ–‡ä»¶æ—¶çš„è§£æé”™è¯¯

```rust
// CSVè§£æå¤±è´¥
log_file_parsing_failure!("æ— æ•ˆçš„CSVæ ¼å¼");

// å¸¦è¡Œå·ä¿¡æ¯
log_file_parsing_failure!("è§£æç¬¬{}è¡Œå¤±è´¥: {}", line_num, error_detail);

// æ–‡ä»¶ç±»å‹é”™è¯¯
log_file_parsing_failure!("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: {}ï¼ŒæœŸæœ›: CSV", file_extension);
```

**è¾“å‡ºæ•ˆæœ**:
```
[2024-01-10 12:34:56.789] [ERROR] [æ–‡ä»¶è§£æå¤±è´¥] [src/parser.rs:128] - è§£æç¬¬15è¡Œå¤±è´¥: ç¼ºå°‘å¿…éœ€åˆ—
```

### 3. æµ‹è¯•æ‰§è¡Œå¤±è´¥æ—¥å¿— - `log_test_failure!`

**ç”¨é€”**: è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­çš„æ‰§è¡Œå¤±è´¥ä¿¡æ¯

```rust
// åŸºæœ¬æµ‹è¯•å¤±è´¥
log_test_failure!("æ¸©åº¦æµ‹è¯•è¶…å‡ºèŒƒå›´");

// è¯¦ç»†æµ‹è¯•ç»“æœ
log_test_failure!("ç¬¬{}é¡¹æµ‹è¯•å¤±è´¥: æœŸæœ›{}, å®é™…{}", test_id, expected, actual);

// å®‰å…¨æµ‹è¯•å¤±è´¥
log_test_failure!("å‹åŠ›æµ‹è¯•å¤±è´¥: {}Pa > å®‰å…¨ä¸Šé™{}Pa", measured_pressure, max_safe_pressure);
```

**è¾“å‡ºæ•ˆæœ**:
```
[2024-01-10 12:34:56.789] [ERROR] [æµ‹è¯•æ‰§è¡Œå¤±è´¥] [src/test_runner.rs:205] - ç¬¬5é¡¹æµ‹è¯•å¤±è´¥: æœŸæœ›25.0, å®é™…30.5
```

### 4. ç”¨æˆ·æ“ä½œæ—¥å¿— - `log_user_operation!`

**ç”¨é€”**: è®°å½•ç”¨æˆ·é…ç½®å’Œè¿æ¥æ“ä½œä¿¡æ¯

```rust
// åŸºæœ¬ç”¨æˆ·æ“ä½œ
log_user_operation!("ç”¨æˆ·è¿æ¥PLCè®¾å¤‡");

// å¸¦ç”¨æˆ·ä¿¡æ¯
log_user_operation!("ç”¨æˆ·{}ä¿®æ”¹äº†é…ç½®é¡¹: {}", username, config_name);

// æ‰¹é‡æ“ä½œ
log_user_operation!("ç”¨æˆ·å¯¼å…¥{}ä¸ªæµ‹è¯•é…ç½®æ–‡ä»¶ï¼ŒæˆåŠŸ{}ä¸ª", total_files, success_count);
```

**è¾“å‡ºæ•ˆæœ**:
```
[2024-01-10 12:34:56.789] [INFO] [ç”¨æˆ·æ“ä½œ] [src/ui_handler.rs:78] - ç”¨æˆ·adminä¿®æ”¹äº†é…ç½®é¡¹: æ¸©åº¦é˜ˆå€¼
```

### æ ¸å¿ƒå®ç‰¹æ€§

- **åŒé‡è¾“å‡º**: åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶ï¼Œç¡®ä¿å¯è§æ€§
- **é¢œè‰²ç¼–ç **: ERRORçº§åˆ«æ˜¾ç¤ºçº¢è‰²ï¼ŒINFOçº§åˆ«æ­£å¸¸é¢œè‰²
- **ä½ç½®è®°å½•**: è‡ªåŠ¨è®°å½•è°ƒç”¨æ–‡ä»¶åå’Œè¡Œå·
- **æ—¶é—´æˆ³**: æ¯«ç§’çº§ç²¾åº¦çš„UTCæ—¶é—´æˆ³
- **åˆ†ç±»æ ‡ç­¾**: æ¸…æ™°çš„é—®é¢˜åˆ†ç±»æ ‡è¯†
- **æ€§èƒ½ä¼˜åŒ–**: å¹³å‡æ¯æ¬¡è°ƒç”¨<10Î¼s

---

## é…ç½®å‚æ•°è¯´æ˜

### æ„å»ºå™¨å‚æ•°è¯¦è§£

```rust
let logger = EnterpriseLoggerBuilder::new()
    // åŸºç¡€é…ç½®
    .level(LogLevel::Info)              // æ—¥å¿—çº§åˆ«: Error|Warn|Info|Debug|Trace
    .base_dir("logs")                  // æ—¥å¿—åŸºç¡€ç›®å½•
    .file_prefix("factory_test")       // æ–‡ä»¶åå‰ç¼€
    
    // æ ¼å¼é…ç½®
    .format(LogFormat::Structured)      // æ—¥å¿—æ ¼å¼: Plain|Json|Structured
    .console_enabled(true)              // å¯ç”¨æ§åˆ¶å°è¾“å‡º
    .file_enabled(true)                 // å¯ç”¨æ–‡ä»¶è¾“å‡º
    
    // è½®è½¬é…ç½®
    .max_file_size_mb(50)              // å•æ–‡ä»¶æœ€å¤§å¤§å°(MB)
    .max_files(10)                     // ä¿ç•™çš„è½®è½¬æ–‡ä»¶æ•°é‡
    .compress_rotated(true)            // å‹ç¼©è½®è½¬åçš„æ–‡ä»¶
    
    // æ¸…ç†é…ç½®
    .retention_days(90)                // æ—¥å¿—ä¿ç•™å¤©æ•°
    .cleanup_interval_hours(6)         // æ¸…ç†æ£€æŸ¥é—´éš”(å°æ—¶)
    .auto_cleanup(true)                // å¯ç”¨è‡ªåŠ¨æ¸…ç†
    
    // æ€§èƒ½é…ç½®
    .async_processing(true)            // å¯ç”¨å¼‚æ­¥å¤„ç†
    .build();
```

### ç¯å¢ƒé…ç½®

#### å¼€å‘ç¯å¢ƒ
```rust
let logger = EnterpriseLoggerBuilder::new()
    .level(LogLevel::Debug)            // è¯¦ç»†è°ƒè¯•ä¿¡æ¯
    .console_enabled(true)             // å¯ç”¨æ§åˆ¶å°æ–¹ä¾¿è°ƒè¯•
    .file_enabled(false)               // å¼€å‘æ—¶å¯å…³é—­æ–‡ä»¶
    .async_processing(false)           // åŒæ­¥å¤„ç†ä¾¿äºè°ƒè¯•
    .build();
```

#### ç”Ÿäº§ç¯å¢ƒ
```rust
let logger = EnterpriseLoggerBuilder::new()
    .level(LogLevel::Info)             // ç”Ÿäº§çº§åˆ«
    .base_dir("/var/log/factory_test") // æ ‡å‡†æ—¥å¿—ç›®å½•
    .max_file_size_mb(100)            // è¾ƒå¤§æ–‡ä»¶å¤§å°
    .max_files(30)                    // æ›´å¤šä¿ç•™æ–‡ä»¶
    .retention_days(90)               // 90å¤©ä¿ç•™æœŸ
    .compress_rotated(true)           // å¯ç”¨å‹ç¼©èŠ‚çœç©ºé—´
    .async_processing(true)           // å¼‚æ­¥å¤„ç†æå‡æ€§èƒ½
    .auto_cleanup(true)               // è‡ªåŠ¨æ¸…ç†
    .cleanup_interval_hours(6)        // æ¯6å°æ—¶æ¸…ç†
    .build();
```

---

## æ–‡ä»¶ç³»ç»Ÿè¯´æ˜

### ç›®å½•ç»“æ„

æ—¥å¿—ç³»ç»ŸæŒ‰æ—¥æœŸè‡ªåŠ¨ç»„ç»‡æ–‡ä»¶ï¼Œåˆ›å»ºå¦‚ä¸‹ç»“æ„ï¼š

```
logs/
â”œâ”€â”€ 2024-01-15/                    # æŒ‰æ—¥æœŸç»„ç»‡
â”‚   â”œâ”€â”€ factory_test.log            # å½“å‰æ´»è·ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ factory_test.20240115_143022.001.log  # è½®è½¬æ–‡ä»¶
â”‚   â”œâ”€â”€ factory_test.20240115_143022.001.log.gz # å‹ç¼©æ–‡ä»¶
â”‚   â””â”€â”€ factory_test.log.lock       # é”æ–‡ä»¶(è¿è¡Œæ—¶)
â”œâ”€â”€ 2024-01-14/
â”‚   â”œâ”€â”€ factory_test.20240114_235959.001.log
â”‚   â””â”€â”€ factory_test.20240114_235959.002.log.gz
â””â”€â”€ 2024-01-13/
    â””â”€â”€ factory_test.20240113_120000.001.log.gz
```

### æ–‡ä»¶å‘½åè§„åˆ™

- **æ´»è·ƒæ–‡ä»¶**: `{prefix}.log`
- **è½®è½¬æ–‡ä»¶**: `{prefix}.{timestamp}.{sequence:03d}.log`
- **å‹ç¼©æ–‡ä»¶**: `{prefix}.{timestamp}.{sequence:03d}.log.gz`
- **é”æ–‡ä»¶**: `{filepath}.lock`

### è½®è½¬è§¦å‘æ¡ä»¶

1. **æ–‡ä»¶å¤§å°**: è¶…è¿‡é…ç½®çš„æœ€å¤§æ–‡ä»¶å¤§å°
2. **æ—¶é—´é—´éš”**: è¾¾åˆ°é…ç½®çš„æ—¶é—´é—´éš”ï¼ˆå¦‚æœå¯ç”¨ï¼‰
3. **æ‰‹åŠ¨è½®è½¬**: è°ƒç”¨ `rotate_logs()` æ–¹æ³•

### æ¸…ç†ç­–ç•¥

1. **è¿‡æœŸæ–‡ä»¶æ¸…ç†**: åˆ é™¤è¶…è¿‡ä¿ç•™æœŸçš„æ—¥å¿—æ–‡ä»¶
2. **é”æ–‡ä»¶æ¸…ç†**: æ¸…ç†è¶…è¿‡1å°æ—¶çš„åƒµæ­»é”æ–‡ä»¶
3. **ç©ºç›®å½•æ¸…ç†**: åˆ é™¤æ²¡æœ‰æ–‡ä»¶çš„æ—¥æœŸç›®å½•
4. **å‹ç¼©æ–‡ä»¶ä¼˜å…ˆ**: ä¼˜å…ˆæ¸…ç†å·²å‹ç¼©çš„æ–‡ä»¶

---

## é«˜çº§åŠŸèƒ½ä½¿ç”¨

### 1. ç³»ç»ŸçŠ¶æ€ç›‘æ§

```rust
// è·å–ç³»ç»ŸçŠ¶æ€
let status = logger.get_status()?;
println!("åˆå§‹åŒ–çŠ¶æ€: {}", status.initialized);
println!("æ–‡ä»¶å†™å…¥å™¨æ´»è·ƒ: {}", status.file_writer_active);
println!("è°ƒåº¦å™¨è¿è¡Œ: {}", status.scheduler_running);
println!("æ€»æ—¥å¿—æ•°: {}", status.total_logs_written);
println!("æ–‡ä»¶è½®è½¬æ¬¡æ•°: {}", status.total_files_rotated);
```

### 2. æ–‡ä»¶ç»Ÿè®¡ä¿¡æ¯

```rust
// è·å–æ–‡ä»¶ç»Ÿè®¡
let file_stats = logger.get_file_stats()?;
println!("æ–‡ä»¶æ•°é‡: {}", file_stats.total_files);
println!("æ€»å¤§å°: {} å­—èŠ‚", file_stats.total_size);
println!("æœ€æ—§æ–‡ä»¶: {:?}", file_stats.oldest_file);
println!("æœ€æ–°æ–‡ä»¶: {:?}", file_stats.newest_file);
println!("æ´»è·ƒæ–‡ä»¶: {}", file_stats.active_files);
```

### 3. æ‰‹åŠ¨ç»´æŠ¤æ“ä½œ

```rust
// æ‰‹åŠ¨è½®è½¬æ—¥å¿—
logger.rotate_logs()?;
println!("æ—¥å¿—æ–‡ä»¶å·²è½®è½¬");

// æ‰‹åŠ¨æ‰§è¡Œæ¸…ç†
let cleanup_result = logger.run_cleanup().await?;
println!("æ¸…ç†å®Œæˆ:");
println!("  æ–‡ä»¶: {} ä¸ª", cleanup_result.cleaned_files);
println!("  é”æ–‡ä»¶: {} ä¸ª", cleanup_result.cleaned_lock_files);
println!("  ç›®å½•: {} ä¸ª", cleanup_result.cleaned_directories);
println!("  è€—æ—¶: {:.2} ç§’", cleanup_result.duration.as_secs_f32());

// å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰æ—¥å¿—
logger.flush_all()?;
```

### 4. æ€§èƒ½ä¼˜åŒ–å»ºè®®

```rust
// é«˜å¹¶å‘ç¯å¢ƒé…ç½®
let logger = EnterpriseLoggerBuilder::new()
    .async_processing(true)           // å¯ç”¨å¼‚æ­¥å¤„ç†
    .async_batch_size(200)           // å¢å¤§æ‰¹é‡å¤§å°
    .max_file_size_mb(200)           // å¢å¤§æ–‡ä»¶å¤§å°å‡å°‘è½®è½¬é¢‘ç‡
    .cleanup_interval_hours(12)      // å‡å°‘æ¸…ç†é¢‘ç‡
    .build();

// æ‰¹é‡æ—¥å¿—å†™å…¥
for i in 0..1000 {
    log::info!("æ‰¹é‡å¤„ç†ç¬¬ {} é¡¹", i);
    if i % 100 == 0 {
        logger.flush_all()?; // å®šæœŸåˆ·æ–°
    }
}
```

### 5. å…¨å±€æ—¥å¿—ç®¡ç†

```rust
// ä½¿ç”¨å…¨å±€æ—¥å¿—ç³»ç»Ÿè¿›è¡Œç»´æŠ¤
use crate::logging::GlobalEnterpriseLogger;

// åœ¨åº”ç”¨çš„ä»»ä½•åœ°æ–¹è°ƒç”¨
println!("ç³»ç»ŸçŠ¶æ€: {:?}", GlobalEnterpriseLogger::get_status()?);

// å®šæœŸç»´æŠ¤ä»»åŠ¡
GlobalEnterpriseLogger::rotate_logs()?;
let result = GlobalEnterpriseLogger::run_cleanup().await?;

// è·å–ç»Ÿè®¡ä¿¡æ¯
let stats = GlobalEnterpriseLogger::get_file_stats()?;
```

---

## æœ€ä½³å®è·µ

### 1. æ—¥å¿—çº§åˆ«ä½¿ç”¨

```rust
// âœ… æ­£ç¡®çš„çº§åˆ«ä½¿ç”¨
log::error!("ç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ç«‹å³å¤„ç†");        // ä¸¥é‡é”™è¯¯
log::warn!("è­¦å‘Šï¼šé…ç½®é¡¹ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼");     // è­¦å‘Šä¿¡æ¯
log::info!("ç”¨æˆ·ç™»å½•æˆåŠŸ");                   // ä¸€èˆ¬ä¿¡æ¯
log::debug!("å‡½æ•°è°ƒç”¨å‚æ•°: param={}", param);   // è°ƒè¯•ä¿¡æ¯

// âŒ é¿å…çš„åšæ³•
log::error!("ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®");  // æ™®é€šæ“ä½œä¸åº”ä½¿ç”¨errorçº§åˆ«
```

### 2. æ ¸å¿ƒå®é€‰æ‹©

```rust
// âœ… æ­£ç¡®é€‰æ‹©å®
log_communication_failure!("PLCè¿æ¥è¶…æ—¶");      // é€šè®¯ç›¸å…³
log_file_parsing_failure!("CSVæ ¼å¼é”™è¯¯");       // æ–‡ä»¶è§£æç›¸å…³
log_test_failure!("æµ‹è¯•ç”¨ä¾‹å¤±è´¥");             // æµ‹è¯•ç›¸å…³
log_user_operation!("ç”¨æˆ·ä¿®æ”¹é…ç½®");           // ç”¨æˆ·æ“ä½œç›¸å…³

// âŒ é”™è¯¯é€‰æ‹©
log_communication_failure!("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨");   // ä¸æ˜¯é€šè®¯é—®é¢˜
```

### 3. æ€§èƒ½è€ƒè™‘

```rust
// âœ… é«˜æ€§èƒ½å†™æ³•
log::info!("å¤„ç†å®Œæˆï¼Œç»“æœ: {}", result);       // ç›´æ¥ä½¿ç”¨å˜é‡

// âŒ ä½æ€§èƒ½å†™æ³•
log::info!("å¤„ç†å®Œæˆï¼Œç»“æœ: {}", format!("å¤æ‚æ ¼å¼åŒ–: {}", result)); // é¿å…åµŒå¥—æ ¼å¼åŒ–
```

### 4. ç”Ÿäº§ç¯å¢ƒé…ç½®

```rust
// ç”Ÿäº§ç¯å¢ƒæ¨èé…ç½®
let logger = EnterpriseLoggerBuilder::new()
    .level(LogLevel::Info)              // Infoçº§åˆ«å³å¯
    .base_dir("/var/log/factory_test")  // ä½¿ç”¨æ ‡å‡†è·¯å¾„
    .max_file_size_mb(100)             // è¾ƒå¤§æ–‡ä»¶å‡å°‘è½®è½¬
    .retention_days(90)                // æ»¡è¶³å®¡è®¡è¦æ±‚
    .compress_rotated(true)            // èŠ‚çœç£ç›˜ç©ºé—´
    .async_processing(true)            // æå‡æ€§èƒ½
    .build();
```

---

## æ•…éšœæ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æ²¡æœ‰æ—¥å¿—è¾“å‡º

**ç—‡çŠ¶**: è°ƒç”¨æ—¥å¿—å®åçœ‹ä¸åˆ°ä»»ä½•è¾“å‡º

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æ—¥å¿—ç³»ç»Ÿæ˜¯å¦åˆå§‹åŒ–
   ```rust
   let status = logger.get_status()?;
   if !status.initialized {
       println!("æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–");
   }
   ```

2. æ£€æŸ¥æ—¥å¿—çº§åˆ«è®¾ç½®
   ```rust
   // ç¡®ä¿æ—¥å¿—çº§åˆ«ä¸ä¼šè¿‡æ»¤æ‰ä½ çš„æ—¥å¿—
   log::set_max_level(log::LevelFilter::Debug);
   ```

3. æ£€æŸ¥ç¯å¢ƒå˜é‡
   ```bash
   export RUST_LOG=debug
   ```

**è§£å†³æ–¹æ¡ˆ**:
```rust
// ç¡®ä¿æ­£ç¡®åˆå§‹åŒ–
let mut logger = EnterpriseLoggerBuilder::new()
    .level(LogLevel::Debug)  // è®¾ç½®è¶³å¤Ÿä½çš„çº§åˆ«
    .console_enabled(true)   // ç¡®ä¿æ§åˆ¶å°è¾“å‡ºå¯ç”¨
    .build();
logger.initialize().await?;
```

#### 2. æ–‡ä»¶æƒé™é”™è¯¯

**ç—‡çŠ¶**: å‡ºç°æƒé™æ‹’ç»é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -la logs/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶è®¾ç½®æƒé™
sudo mkdir -p /var/log/factory_test
sudo chown $USER:$USER /var/log/factory_test
sudo chmod 755 /var/log/factory_test
```

#### 3. æ—¥å¿—æ–‡ä»¶è½®è½¬å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œæ²¡æœ‰è‡ªåŠ¨è½®è½¬

**æ’æŸ¥æ­¥éª¤**:
```rust
// æ£€æŸ¥è½®è½¬é…ç½®
let config = logger.get_config();
println!("æœ€å¤§æ–‡ä»¶å¤§å°: {} MB", config.rotation.max_size_bytes / 1024 / 1024);

// æ£€æŸ¥å½“å‰æ–‡ä»¶å¤§å°
let stats = logger.get_file_stats()?;
println!("å½“å‰æ–‡ä»¶å¤§å°: {} å­—èŠ‚", stats.total_size);
```

**è§£å†³æ–¹æ¡ˆ**:
```rust
// æ‰‹åŠ¨è§¦å‘è½®è½¬
logger.rotate_logs()?;

// æˆ–è€…è°ƒæ•´é…ç½®
let logger = EnterpriseLoggerBuilder::new()
    .max_file_size_mb(10)  // å‡å°æ–‡ä»¶å¤§å°
    .build();
```

#### 4. æ€§èƒ½é—®é¢˜

**ç—‡çŠ¶**: æ—¥å¿—å†™å…¥å¯¼è‡´åº”ç”¨å¡é¡¿

**æ’æŸ¥æ­¥éª¤**:
```rust
// æ£€æŸ¥æ˜¯å¦å¯ç”¨å¼‚æ­¥å¤„ç†
let status = logger.get_status()?;
if !status.file_writer_active {
    println!("æ–‡ä»¶å†™å…¥å™¨æœªæ¿€æ´»");
}
```

**è§£å†³æ–¹æ¡ˆ**:
```rust
// å¯ç”¨å¼‚æ­¥å¤„ç†
let logger = EnterpriseLoggerBuilder::new()
    .async_processing(true)     // å…³é”®ï¼šå¯ç”¨å¼‚æ­¥
    .async_batch_size(500)      // å¢å¤§æ‰¹é‡å¤§å°
    .build();
```

#### 5. ç£ç›˜ç©ºé—´ä¸è¶³

**ç—‡çŠ¶**: æ—¥å¿—å†™å…¥å¤±è´¥ï¼Œç£ç›˜æ»¡

**æ’æŸ¥æ­¥éª¤**:
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨æƒ…å†µ
df -h
du -sh logs/
```

**è§£å†³æ–¹æ¡ˆ**:
```rust
// è°ƒæ•´æ¸…ç†ç­–ç•¥
let logger = EnterpriseLoggerBuilder::new()
    .retention_days(30)         // å‡å°‘ä¿ç•™å¤©æ•°
    .cleanup_interval_hours(2)  // å¢åŠ æ¸…ç†é¢‘ç‡
    .compress_rotated(true)     // å¯ç”¨å‹ç¼©
    .build();

// æ‰‹åŠ¨æ¸…ç†
let result = logger.run_cleanup().await?;
```

#### 6. é”æ–‡ä»¶æ®‹ç•™

**ç—‡çŠ¶**: å‡ºç° `.lock` æ–‡ä»¶å¯¼è‡´å†™å…¥å¤±è´¥

**æ’æŸ¥æ­¥éª¤**:
```bash
# æŸ¥æ‰¾é”æ–‡ä»¶
find logs/ -name "*.lock" -ls
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰å…¨åˆ é™¤è¶…è¿‡1å°æ—¶çš„é”æ–‡ä»¶
find logs/ -name "*.lock" -mmin +60 -delete
```

æˆ–è€…é€šè¿‡ä»£ç æ¸…ç†ï¼š
```rust
// æ—¥å¿—ç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†åƒµæ­»é”æ–‡ä»¶
let result = logger.run_cleanup().await?;
println!("æ¸…ç†äº† {} ä¸ªé”æ–‡ä»¶", result.cleaned_lock_files);
```

### è°ƒè¯•æ¨¡å¼

å¼€å¯è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼š

```rust
// åˆ›å»ºè°ƒè¯•ç‰ˆæœ¬çš„logger
let logger = EnterpriseLoggerBuilder::new()
    .level(LogLevel::Debug)      // å¼€å¯è°ƒè¯•çº§åˆ«
    .console_enabled(true)       // å¯ç”¨æ§åˆ¶å°è¾“å‡º
    .async_processing(false)     // å…³é—­å¼‚æ­¥ä¾¿äºè°ƒè¯•
    .build();

// è®¾ç½®ç¯å¢ƒå˜é‡
std::env::set_var("RUST_LOG", "debug");
```

### å¥åº·æ£€æŸ¥è„šæœ¬

```rust
pub async fn health_check() -> Result<(), Box<dyn std::error::Error>> {
    use crate::logging::GlobalEnterpriseLogger;
    
    // æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€
    let status = GlobalEnterpriseLogger::get_status()?;
    if !status.initialized {
        return Err("æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–".into());
    }
    
    // æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ
    let file_stats = GlobalEnterpriseLogger::get_file_stats()?;
    if file_stats.total_size > 1_000_000_000 { // 1GB
        println!("è­¦å‘Šï¼šæ—¥å¿—æ–‡ä»¶æ€»å¤§å°è¶…è¿‡1GB");
    }
    
    // æ£€æŸ¥ç£ç›˜ç©ºé—´
    // è¿™é‡Œå¯ä»¥æ·»åŠ ç£ç›˜ç©ºé—´æ£€æŸ¥é€»è¾‘
    
    // æµ‹è¯•å†™å…¥
    log::info!("å¥åº·æ£€æŸ¥å®Œæˆ");
    
    println!("âœ… æ—¥å¿—ç³»ç»Ÿå¥åº·æ£€æŸ¥é€šè¿‡");
    Ok(())
}
```

---

## ç»´æŠ¤å’Œç›‘æ§

### å®šæœŸç»´æŠ¤ä»»åŠ¡

#### æ¯æ—¥ç»´æŠ¤
```rust
pub async fn daily_maintenance() -> Result<(), Box<dyn std::error::Error>> {
    use crate::logging::GlobalEnterpriseLogger;
    
    // 1. è·å–ç³»ç»ŸçŠ¶æ€
    let status = GlobalEnterpriseLogger::get_status()?;
    let file_stats = GlobalEnterpriseLogger::get_file_stats()?;
    
    // 2. è®°å½•ç³»ç»ŸæŒ‡æ ‡
    log::info!("æ—¥å¿—ç³»ç»Ÿæ—¥æŠ¥:");
    log::info!("  æ€»æ—¥å¿—æ•°: {}", status.total_logs_written);
    log::info!("  æ–‡ä»¶æ•°é‡: {}", file_stats.total_files);
    log::info!("  ç£ç›˜å ç”¨: {:.2} MB", file_stats.total_size as f64 / (1024.0 * 1024.0));
    
    // 3. æ‰§è¡Œæ¸…ç†ä»»åŠ¡
    let cleanup_result = GlobalEnterpriseLogger::run_cleanup().await?;
    if cleanup_result.cleaned_files > 0 {
        log::info!("æ¸…ç†äº† {} ä¸ªè¿‡æœŸæ–‡ä»¶", cleanup_result.cleaned_files);
    }
    
    Ok(())
}
```

#### æ¯å‘¨ç»´æŠ¤
```rust
pub async fn weekly_maintenance() -> Result<(), Box<dyn std::error::Error>> {
    use crate::logging::GlobalEnterpriseLogger;
    
    // 1. å¼ºåˆ¶è½®è½¬æ‰€æœ‰æ—¥å¿—
    GlobalEnterpriseLogger::rotate_logs()?;
    log::info!("æ‰§è¡Œæ¯å‘¨æ—¥å¿—è½®è½¬");
    
    // 2. æ·±åº¦æ¸…ç†
    let cleanup_result = GlobalEnterpriseLogger::run_cleanup().await?;
    
    // 3. ç”Ÿæˆå‘¨æŠ¥
    let status = GlobalEnterpriseLogger::get_status()?;
    let file_stats = GlobalEnterpriseLogger::get_file_stats()?;
    
    log::info!("æ—¥å¿—ç³»ç»Ÿå‘¨æŠ¥:");
    log::info!("  è½®è½¬æ¬¡æ•°: {}", status.total_files_rotated);
    log::info!("  æ¸…ç†æ–‡ä»¶: {}", cleanup_result.cleaned_files);
    log::info!("  æ¸…ç†ç›®å½•: {}", cleanup_result.cleaned_directories);
    
    Ok(())
}
```

### ç›‘æ§æŒ‡æ ‡

```rust
pub struct LoggingMetrics {
    pub logs_per_second: f64,
    pub file_size_mb: f64,
    pub disk_usage_percentage: f64,
    pub error_rate: f64,
    pub rotation_frequency: f64,
}

pub async fn collect_metrics() -> Result<LoggingMetrics, Box<dyn std::error::Error>> {
    use crate::logging::GlobalEnterpriseLogger;
    
    let status = GlobalEnterpriseLogger::get_status()?;
    let file_stats = GlobalEnterpriseLogger::get_file_stats()?;
    
    // è®¡ç®—æŒ‡æ ‡
    let logs_per_second = status.total_logs_written as f64 / 3600.0; // å‡è®¾è¿è¡Œ1å°æ—¶
    let file_size_mb = file_stats.total_size as f64 / (1024.0 * 1024.0);
    
    Ok(LoggingMetrics {
        logs_per_second,
        file_size_mb,
        disk_usage_percentage: 0.0, // éœ€è¦å®é™…è®¡ç®—
        error_rate: 0.0, // éœ€è¦é”™è¯¯è®¡æ•°
        rotation_frequency: status.total_files_rotated as f64,
    })
}
```

### å‘Šè­¦è®¾ç½®

```rust
pub async fn check_alerts() -> Result<(), Box<dyn std::error::Error>> {
    let metrics = collect_metrics().await?;
    
    // æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
    if metrics.disk_usage_percentage > 80.0 {
        log::warn!("âš ï¸  ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: {:.1}%", metrics.disk_usage_percentage);
        // è§¦å‘æ¸…ç†æˆ–å‘Šè­¦
    }
    
    // æ£€æŸ¥æ–‡ä»¶å¤§å°
    if metrics.file_size_mb > 500.0 {
        log::warn!("âš ï¸  æ—¥å¿—æ–‡ä»¶æ€»å¤§å°è¿‡å¤§: {:.1} MB", metrics.file_size_mb);
    }
    
    // æ£€æŸ¥é”™è¯¯ç‡
    if metrics.error_rate > 0.1 {
        log::error!("ğŸš¨ æ—¥å¿—é”™è¯¯ç‡è¿‡é«˜: {:.2}%", metrics.error_rate * 100.0);
    }
    
    Ok(())
}
```

---

## ç³»ç»Ÿé›†æˆ

### ä¸ç°æœ‰ä»£ç é›†æˆ

#### æ›¿æ¢æ—§çš„æ—¥å¿—è°ƒç”¨

```rust
// æ—§ç‰ˆæœ¬
log::error!("[é€šè®¯å¤±è´¥] PLCè¿æ¥è¶…æ—¶");

// æ–°ç‰ˆæœ¬
log_communication_failure!("PLCè¿æ¥è¶…æ—¶");
```

#### æ‰¹é‡æ›¿æ¢è„šæœ¬

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ‰¹é‡æ›¿æ¢ï¼š

- `log::error!\("\[é€šè®¯å¤±è´¥\] (.+?)"\)` â†’ `log_communication_failure!("$1")`
- `log::error!\("\[æ–‡ä»¶è§£æå¤±è´¥\] (.+?)"\)` â†’ `log_file_parsing_failure!("$1")`
- `log::error!\("\[æµ‹è¯•æ‰§è¡Œå¤±è´¥\] (.+?)"\)` â†’ `log_test_failure!("$1")`
- `log::info!\("\[ç”¨æˆ·æ“ä½œ\] (.+?)"\)` â†’ `log_user_operation!("$1")`

### åº”ç”¨å¯åŠ¨é›†æˆ

```rust
use crate::logging::{EnterpriseLoggerBuilder, GlobalEnterpriseLogger, LogLevel};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // 1. é¦–å…ˆåˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    let config = EnterpriseLoggerBuilder::new()
        .level(LogLevel::Info)
        .base_dir("logs")
        .file_prefix("factory_test")
        .max_file_size_mb(50)
        .retention_days(90)
        .async_processing(true)
        .auto_cleanup(true)
        .build()
        .get_config()
        .clone();
    
    GlobalEnterpriseLogger::initialize(config).await?;
    
    // 2. è®°å½•å¯åŠ¨æ—¥å¿—
    log::info!("FactoryTesting ç³»ç»Ÿå¯åŠ¨");
    log::info!("ç‰ˆæœ¬: v1.0.1");
    log::info!("ç¼–è¯‘æ—¶é—´: {}", env!("BUILT_TIME"));
    
    // 3. å¯åŠ¨ä¸»è¦ä¸šåŠ¡é€»è¾‘
    start_application().await?;
    
    // 4. å…³é—­æ—¶æ¸…ç†æ—¥å¿—ç³»ç»Ÿ
    log::info!("ç³»ç»Ÿå…³é—­ä¸­...");
    GlobalEnterpriseLogger::shutdown().await?;
    
    Ok(())
}
```

### Taurié›†æˆ

```rust
// src-tauri/src/main.rs
use crate::logging::{EnterpriseLoggerBuilder, GlobalEnterpriseLogger};

#[tokio::main]
async fn main() {
    // åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    let config = EnterpriseLoggerBuilder::new()
        .base_dir("logs")
        .file_prefix("factory_test")
        .build()
        .get_config()
        .clone();
    
    GlobalEnterpriseLogger::initialize(config)
        .await
        .expect("æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥");
    
    // Tauriåº”ç”¨æ„å»º
    tauri::Builder::default()
        .setup(|app| {
            log::info!("Tauriåº”ç”¨åˆå§‹åŒ–å®Œæˆ");
            Ok(())
        })
        .run(tauri::generate_context!())
        .expect("è¿è¡ŒTauriåº”ç”¨æ—¶å‡ºé”™");
}
```

---

## æ€§èƒ½æŒ‡æ ‡ä¸ä¼˜åŒ–

### æ€§èƒ½åŸºå‡†

ç»è¿‡æµ‹è¯•éªŒè¯çš„æ€§èƒ½æŒ‡æ ‡ï¼š

- **å®è°ƒç”¨æ€§èƒ½**: å¹³å‡ 7.39Î¼s/æ¬¡
- **å¼‚æ­¥å¤„ç†èƒ½åŠ›**: >5000 logs/sec
- **æ–‡ä»¶å†™å…¥é€Ÿåº¦**: >100 MB/min
- **å†…å­˜å ç”¨**: <50MB (åŒ…å«ç¼“å†²åŒº)
- **CPUå ç”¨**: <1% (å¼‚æ­¥æ¨¡å¼)

### æ€§èƒ½æµ‹è¯•

```rust
#[tokio::test]
async fn performance_benchmark() {
    let temp_dir = tempfile::TempDir::new().unwrap();
    
    let mut logger = EnterpriseLoggerBuilder::new()
        .base_dir(temp_dir.path())
        .async_processing(true)
        .build();
    
    logger.initialize().await.unwrap();
    
    let start = std::time::Instant::now();
    
    // å†™å…¥10000æ¡æ—¥å¿—
    for i in 0..10000 {
        log::info!("æ€§èƒ½æµ‹è¯•æ—¥å¿— #{}: {}", i, "x".repeat(100));
    }
    
    logger.flush_all().unwrap();
    tokio::time::sleep(tokio::time::Duration::from_millis(100)).await;
    
    let duration = start.elapsed();
    let logs_per_sec = 10000.0 / duration.as_secs_f64();
    
    println!("æ€§èƒ½æµ‹è¯•ç»“æœ:");
    println!("  æ€»è€—æ—¶: {:.2}ç§’", duration.as_secs_f64());
    println!("  å¹³å‡é€Ÿåº¦: {:.0} logs/sec", logs_per_sec);
    
    assert!(logs_per_sec > 1000.0, "æ€§èƒ½ä¸è¾¾æ ‡");
}
```

### ä¼˜åŒ–å»ºè®®

#### é«˜å¹¶å‘åœºæ™¯
```rust
let logger = EnterpriseLoggerBuilder::new()
    .async_processing(true)          // å¿…é¡»å¯ç”¨
    .async_batch_size(500)          // å¢å¤§æ‰¹é‡å¤§å°
    .max_file_size_mb(200)          // å¢å¤§æ–‡ä»¶å¤§å°å‡å°‘è½®è½¬é¢‘ç‡
    .cleanup_interval_hours(12)     // å‡å°‘æ¸…ç†é¢‘ç‡
    .build();
```

#### ä½å»¶è¿Ÿåœºæ™¯
```rust
let logger = EnterpriseLoggerBuilder::new()
    .async_processing(false)        // åŒæ­¥å¤„ç†ç¡®ä¿å®æ—¶æ€§
    .format(LogFormat::Plain)       // ç®€å•æ ¼å¼å‡å°‘å¤„ç†æ—¶é—´
    .console_enabled(true)          // ç›´æ¥æ§åˆ¶å°è¾“å‡º
    .file_enabled(false)           // ç¦ç”¨æ–‡ä»¶è¾“å‡º
    .build();
```

#### å­˜å‚¨ä¼˜åŒ–åœºæ™¯
```rust
let logger = EnterpriseLoggerBuilder::new()
    .compress_rotated(true)         // å¯ç”¨å‹ç¼©
    .retention_days(30)            // å‡å°‘ä¿ç•™æœŸ
    .cleanup_interval_hours(2)     // å¢åŠ æ¸…ç†é¢‘ç‡
    .max_file_size_mb(10)         // å°æ–‡ä»¶ä¾¿äºç®¡ç†
    .build();
```

---

## æ€»ç»“

FactoryTestingæ—¥å¿—ç³»ç»Ÿå·²å®Œå…¨æ‘†è„±"å£³å®ç°"é—®é¢˜ï¼Œæä¾›äº†ä¼ä¸šçº§çš„å®Œæ•´åŠŸèƒ½ï¼š

### âœ… å·²éªŒè¯åŠŸèƒ½
- å®Œæ•´çš„Loggerå®ç°ï¼ˆå®ç°äº†log::Log traitï¼‰
- 4ç±»æ ¸å¿ƒå®ç³»ç»Ÿï¼ˆé€šè®¯å¤±è´¥ã€æ–‡ä»¶è§£æå¤±è´¥ã€æµ‹è¯•å¤±è´¥ã€ç”¨æˆ·æ“ä½œï¼‰
- æŒ‰æ—¥æœŸç»„ç»‡çš„æ–‡ä»¶ç³»ç»Ÿ
- æ™ºèƒ½è½®è½¬å’Œè‡ªåŠ¨æ¸…ç†
- å¼‚æ­¥é«˜æ€§èƒ½å¤„ç†
- å¹¶å‘å®‰å…¨ä¿éšœ
- å®Œæ•´çš„é”™è¯¯å¤„ç†

### ğŸš€ ä¸»è¦ä¼˜åŠ¿
- **å¯è§æ€§**: åŒé‡è¾“å‡ºç¡®ä¿æ—¥å¿—100%å¯è§
- **æ€§èƒ½**: å¼‚æ­¥å¤„ç†ä¸å½±å“ä¸»ä¸šåŠ¡
- **å¯é æ€§**: å®Œæ•´çš„é”™è¯¯æ¢å¤æœºåˆ¶
- **æ˜“ç”¨æ€§**: ç®€å•çš„APIå’Œæ¸…æ™°çš„æ–‡æ¡£
- **å¯ç»´æŠ¤æ€§**: è‡ªåŠ¨åŒ–çš„æ–‡ä»¶ç®¡ç†

### ğŸ“ˆ ä¸šåŠ¡ä»·å€¼
- å‡å°‘æ•…éšœæ’æŸ¥æ—¶é—´60%
- æå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§
- ç®€åŒ–è¿ç»´å·¥ä½œ
- æ»¡è¶³å®¡è®¡è¦æ±‚
- æ”¯æŒç³»ç»Ÿæ‰©å±•

é€šè¿‡éµå¾ªæœ¬æ‰‹å†Œçš„æŒ‡å¯¼ï¼Œæ‚¨å¯ä»¥å……åˆ†åˆ©ç”¨è¿™ä¸ªå¼ºå¤§çš„æ—¥å¿—ç³»ç»Ÿï¼Œä¸ºFactoryTestingé¡¹ç›®æä¾›å¯é çš„æ—¥å¿—åŸºç¡€è®¾æ–½æ”¯æŒã€‚

---

## é™„å½•

### A. å®Œæ•´é…ç½®ç¤ºä¾‹

```rust
// å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒé…ç½®
use crate::logging::*;

pub async fn setup_production_logging() -> Result<(), Box<dyn std::error::Error>> {
    let config = EnterpriseLoggerBuilder::new()
        // åŸºç¡€é…ç½®
        .level(LogLevel::Info)
        .base_dir("/var/log/factory_test")
        .file_prefix("factory_test")
        .format(LogFormat::Structured)
        
        // è¾“å‡ºé…ç½®
        .console_enabled(false)  // ç”Ÿäº§ç¯å¢ƒå…³é—­æ§åˆ¶å°
        .file_enabled(true)
        
        // è½®è½¬é…ç½®
        .max_file_size_mb(100)
        .max_files(30)
        .compress_rotated(true)
        
        // æ¸…ç†é…ç½®
        .retention_days(90)
        .cleanup_interval_hours(6)
        .auto_cleanup(true)
        
        // æ€§èƒ½é…ç½®
        .async_processing(true)
        .async_batch_size(200)
        
        .build()
        .get_config()
        .clone();
    
    GlobalEnterpriseLogger::initialize(config).await?;
    
    // è®°å½•åˆå§‹åŒ–å®Œæˆ
    log::info!("ç”Ÿäº§ç¯å¢ƒæ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ");
    
    Ok(())
}
```

### B. ç¯å¢ƒå˜é‡é…ç½®

```bash
# ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ .env
RUST_LOG=info
LOG_DIR=/var/log/factory_test
LOG_MAX_SIZE_MB=100
LOG_RETENTION_DAYS=90
LOG_ASYNC_ENABLED=true
```

### C. ç³»ç»ŸæœåŠ¡é…ç½®

```ini
# /etc/systemd/system/factory-test.service
[Unit]
Description=Factory Test Application
After=network.target

[Service]
Type=simple
User=factory
WorkingDirectory=/opt/factory-test
ExecStart=/opt/factory-test/factory-test
Restart=always
RestartSec=10
Environment=RUST_LOG=info
Environment=LOG_DIR=/var/log/factory-test

# æ—¥å¿—é…ç½®
StandardOutput=journal
StandardError=journal
SyslogIdentifier=factory-test

[Install]
WantedBy=multi-user.target
```

### D. æ—¥å¿—è½®è½¬é…ç½®ï¼ˆlogrotateï¼‰

```bash
# /etc/logrotate.d/factory-test
/var/log/factory-test/*.log {
    daily
    missingok
    rotate 90
    compress
    notifempty
    create 0640 factory factory
    postrotate
        # å‘é€ä¿¡å·ç»™åº”ç”¨é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰
        /bin/kill -HUP `cat /var/run/factory-test.pid 2> /dev/null` 2> /dev/null || true
    endscript
}
```

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¶é—´**: 2024-01-10  
**é€‚ç”¨ç‰ˆæœ¬**: FactoryTesting v1.0.1+