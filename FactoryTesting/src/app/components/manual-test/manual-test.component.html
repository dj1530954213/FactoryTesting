<!-- æ‰‹åŠ¨æµ‹è¯•é¡µé¢ -->
<div class="manual-test-container">
  <!-- é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="icon-manual-test"></i>
        æ‰‹åŠ¨æµ‹è¯•
      </h1>
      <p class="page-description">å¯¹é€‰å®šé€šé“æ‰§è¡Œæ‰‹åŠ¨æµ‹è¯•æ“ä½œï¼ŒåŒ…æ‹¬è¯»å€¼ã€å†™å€¼å’Œç‰¹å®šæµ‹è¯•é¡¹</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="goToDashboard()">
        <i class="icon-dashboard"></i>
        è¿”å›ä»ªè¡¨æ¿
      </button>
      <button class="btn btn-primary" (click)="goToTestExecution()">
        <i class="icon-test"></i>
        è‡ªåŠ¨æµ‹è¯•
      </button>
    </div>
  </div>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <div class="statistics-overview">
    <div class="stat-card">
      <div class="stat-icon total">ğŸ“Š</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.totalChannels }}</div>
        <div class="stat-label">æ€»é€šé“æ•°</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon ready">ğŸŸ¢</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.readyForTest }}</div>
        <div class="stat-label">å°±ç»ª</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon progress">ğŸŸ¡</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.inProgress }}</div>
        <div class="stat-label">è¿›è¡Œä¸­</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon completed">ğŸŸ¢</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.completed }}</div>
        <div class="stat-label">å·²å®Œæˆ</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon failed">ğŸ”´</div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.failed }}</div>
        <div class="stat-label">å¤±è´¥</div>
      </div>
    </div>
  </div>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <div class="main-content">
    <!-- å·¦ä¾§ï¼šé€šé“é€‰æ‹©åŒºåŸŸ -->
    <div class="channel-selection-panel">
      <div class="panel-header">
        <h2>é€šé“é€‰æ‹©</h2>
        <button class="btn btn-sm btn-outline" (click)="loadChannels()" [disabled]="isLoading">
          <i class="icon-refresh" [class.spinning]="isLoading"></i>
          åˆ·æ–°
        </button>
      </div>

      <!-- ç­›é€‰æ§ä»¶ -->
      <div class="filter-controls">
        <div class="filter-group">
          <label>æœç´¢é€šé“</label>
          <input 
            type="text" 
            class="form-control" 
            placeholder="è¾“å…¥é€šé“æ ‡ç­¾æˆ–æè¿°..." 
            [(ngModel)]="searchTerm"
            (input)="filterChannels()">
        </div>
        <div class="filter-group">
          <label>æ¨¡å—ç±»å‹</label>
          <select class="form-control" [(ngModel)]="selectedModuleType" (change)="filterChannels()">
            <option value="">å…¨éƒ¨ç±»å‹</option>
            <option *ngFor="let type of moduleTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label>çŠ¶æ€</label>
          <select class="form-control" [(ngModel)]="selectedStatus" (change)="filterChannels()">
            <option value="">å…¨éƒ¨çŠ¶æ€</option>
            <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
          </select>
        </div>
      </div>

      <!-- é€šé“åˆ—è¡¨ -->
      <div class="channel-list" *ngIf="!isLoading && !error">
        <div 
          class="channel-item" 
          *ngFor="let channel of filteredChannels"
          [class.selected]="selectedChannel?.instanceId === channel.instanceId"
          (click)="selectChannel(channel)">
          <div class="channel-header">
            <span class="channel-label">{{ channel.channelLabel }}</span>
            <span class="channel-status" [class]="'status-' + channel.overallStatus.toLowerCase()">
              {{ channel.overallStatus }}
            </span>
          </div>
          <div class="channel-info">
            <div class="channel-description">{{ channel.description }}</div>
            <div class="channel-details">
              <span class="module-type module-{{ channel.moduleType.toLowerCase() }}">
                {{ channel.moduleType }}
              </span>
              <span class="plc-address">{{ channel.definition.plcAddress }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- åŠ è½½çŠ¶æ€ -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>æ­£åœ¨åŠ è½½é€šé“æ•°æ®...</p>
      </div>

      <!-- é”™è¯¯çŠ¶æ€ -->
      <div class="error-state" *ngIf="error">
        <div class="error-icon">âš ï¸</div>
        <p>{{ error }}</p>
        <button class="btn btn-primary" (click)="loadChannels()">é‡è¯•</button>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div class="empty-state" *ngIf="!isLoading && !error && filteredChannels.length === 0">
        <div class="empty-icon">ğŸ“­</div>
        <p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é€šé“</p>
        <button class="btn btn-outline" (click)="searchTerm = ''; selectedModuleType = ''; selectedStatus = ''; filterChannels()">
          æ¸…é™¤ç­›é€‰
        </button>
      </div>
    </div>

    <!-- å³ä¾§ï¼šæµ‹è¯•æ“ä½œåŒºåŸŸ -->
    <div class="test-operation-panel">
      <!-- é€‰ä¸­é€šé“ä¿¡æ¯ -->
      <div class="selected-channel-info" *ngIf="selectedChannel">
        <div class="panel-header">
          <h2>é€šé“è¯¦æƒ…</h2>
        </div>
        <div class="channel-details-card">
          <div class="detail-row">
            <label>é€šé“æ ‡ç­¾:</label>
            <span>{{ selectedChannel.channelLabel }}</span>
          </div>
          <div class="detail-row">
            <label>æè¿°:</label>
            <span>{{ selectedChannel.description }}</span>
          </div>
          <div class="detail-row">
            <label>æ¨¡å—ç±»å‹:</label>
            <span class="module-type module-{{ selectedChannel.moduleType.toLowerCase() }}">
              {{ selectedChannel.moduleType }}
            </span>
          </div>
          <div class="detail-row">
            <label>æ•°æ®ç±»å‹:</label>
            <span>{{ selectedChannel.definition.pointDataType }}</span>
          </div>
          <div class="detail-row">
            <label>PLCåœ°å€:</label>
            <span class="plc-address">{{ selectedChannel.definition.plcAddress }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedChannel.definition.expectedValue !== undefined">
            <label>æœŸæœ›å€¼:</label>
            <span>{{ selectedChannel.definition.expectedValue }}</span>
          </div>
          <div class="detail-row" *ngIf="selectedChannel.definition.tolerance !== undefined">
            <label>å®¹å·®:</label>
            <span>Â± {{ selectedChannel.definition.tolerance }}</span>
          </div>
        </div>
      </div>

      <!-- æµ‹è¯•é¡¹é€‰æ‹© -->
      <div class="test-item-selection" *ngIf="selectedChannel">
        <div class="panel-header">
          <h3>é€‰æ‹©æµ‹è¯•é¡¹</h3>
        </div>
        <div class="test-items-grid">
          <div 
            class="test-item-card" 
            *ngFor="let subTest of availableSubTests"
            [class.disabled]="!subTest.applicable"
            [class.selected]="selectedSubTest?.name === subTest.name"
            (click)="subTest.applicable && selectSubTest(subTest)">
            <div class="test-item-header">
              <span class="test-item-name">{{ subTest.displayName }}</span>
              <span class="test-item-status" *ngIf="!subTest.applicable">ä¸é€‚ç”¨</span>
            </div>
            <div class="test-item-description">{{ subTest.description }}</div>
          </div>
        </div>
      </div>

      <!-- æµ‹è¯•æ“ä½œé¢æ¿ -->
      <div class="test-operation-area" *ngIf="selectedChannel && selectedSubTest">
        <div class="panel-header">
          <h3>{{ selectedSubTest.displayName }}</h3>
        </div>

        <!-- å½“å‰å€¼æ˜¾ç¤º -->
        <div class="current-value-display" *ngIf="currentValue !== null">
          <label>å½“å‰å€¼:</label>
          <div class="value-display">
            <span class="value">{{ currentValue }}</span>
            <span class="unit" *ngIf="selectedChannel.moduleType === 'AI' || selectedChannel.moduleType === 'AO'">
              {{ selectedChannel.definition.pointDataType === 'Float32' ? '' : '' }}
            </span>
          </div>
        </div>

        <!-- å†™å…¥å€¼è¾“å…¥ -->
        <div class="input-section" *ngIf="selectedSubTest.name === 'WriteValue'">
          <label>å†™å…¥å€¼:</label>
          <div class="input-group">
            <input 
              *ngIf="getInputType() !== 'checkbox'"
              [type]="getInputType()"
              class="form-control"
              [placeholder]="getInputPlaceholder()"
              [(ngModel)]="inputValue"
              [disabled]="isTestInProgress">
            <div class="checkbox-group" *ngIf="getInputType() === 'checkbox'">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="inputValue"
                  [disabled]="isTestInProgress">
                <span class="checkbox-text">{{ inputValue ? 'å¼€å¯' : 'å…³é—­' }}</span>
              </label>
            </div>
          </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
          <button 
            class="btn btn-primary"
            *ngIf="selectedSubTest.name === 'ReadValue'"
            (click)="executeReadValue()"
            [disabled]="isTestInProgress">
            <i class="icon-read" [class.spinning]="isTestInProgress"></i>
            {{ isTestInProgress ? 'è¯»å–ä¸­...' : 'è¯»å–æ•°å€¼' }}
          </button>

          <button 
            class="btn btn-success"
            *ngIf="selectedSubTest.name === 'WriteValue'"
            (click)="executeWriteValue()"
            [disabled]="isTestInProgress || inputValue === null">
            <i class="icon-write" [class.spinning]="isTestInProgress"></i>
            {{ isTestInProgress ? 'å†™å…¥ä¸­...' : 'å†™å…¥æ•°å€¼' }}
          </button>

          <button 
            class="btn btn-warning"
            *ngIf="selectedSubTest.name !== 'ReadValue' && selectedSubTest.name !== 'WriteValue'"
            (click)="executeSpecificTest()"
            [disabled]="isTestInProgress">
            <i class="icon-test" [class.spinning]="isTestInProgress"></i>
            {{ isTestInProgress ? 'æ‰§è¡Œä¸­...' : 'æ‰§è¡Œæµ‹è¯•' }}
          </button>
        </div>

        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
        <div class="test-result" *ngIf="testResult">
          <div class="result-header" [class]="testResult.success ? 'success' : 'error'">
            <i class="result-icon" [class]="testResult.success ? 'icon-success' : 'icon-error'"></i>
            <span class="result-status">{{ testResult.success ? 'æˆåŠŸ' : 'å¤±è´¥' }}</span>
            <span class="result-timestamp">{{ testResult.timestamp }}</span>
          </div>
          <div class="result-content">
            <p class="result-message">{{ testResult.message }}</p>
            <div class="result-value" *ngIf="testResult.value !== undefined">
              <label>è¿”å›å€¼:</label>
              <span class="value">{{ testResult.value }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- æœªé€‰æ‹©é€šé“çš„æç¤º -->
      <div class="no-selection-state" *ngIf="!selectedChannel">
        <div class="no-selection-icon">ğŸ¯</div>
        <h3>è¯·é€‰æ‹©ä¸€ä¸ªé€šé“</h3>
        <p>ä»å·¦ä¾§åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé€šé“å¼€å§‹æ‰‹åŠ¨æµ‹è¯•</p>
      </div>

      <!-- æœªé€‰æ‹©æµ‹è¯•é¡¹çš„æç¤º -->
      <div class="no-test-selection-state" *ngIf="selectedChannel && !selectedSubTest">
        <div class="no-selection-icon">ğŸ”§</div>
        <h3>è¯·é€‰æ‹©æµ‹è¯•é¡¹</h3>
        <p>é€‰æ‹©ä¸€ä¸ªé€‚ç”¨çš„æµ‹è¯•é¡¹æ¥æ‰§è¡Œæ‰‹åŠ¨æ“ä½œ</p>
      </div>
    </div>
  </div>
</div>
