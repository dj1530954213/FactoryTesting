<div class="batch-management-container">
  <div class="page-header">
    <h1>ğŸ“¦ æ‰¹æ¬¡ç®¡ç†</h1>
    <p>æŸ¥çœ‹å’Œç®¡ç†æµ‹è¯•æ‰¹æ¬¡å†å²è®°å½•</p>
  </div>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <div class="stats-overview">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“Š</div>
      <div class="stat-info">
        <div class="stat-number">{{ totalBatches }}</div>
        <div class="stat-label">æ€»æ‰¹æ¬¡æ•°</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-info">
        <div class="stat-number">{{ completedBatches }}</div>
        <div class="stat-label">å·²å®Œæˆ</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ”„</div>
      <div class="stat-info">
        <div class="stat-number">{{ inProgressBatches }}</div>
        <div class="stat-label">è¿›è¡Œä¸­</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-info">
        <div class="stat-number">{{ successRate }}%</div>
        <div class="stat-label">æˆåŠŸç‡</div>
      </div>
    </div>
  </div>

  <!-- ç­›é€‰å’Œæœç´¢ -->
  <div class="filter-section">
    <div class="search-group">
      <input type="text" placeholder="æœç´¢æ‰¹æ¬¡..." class="search-input" [(ngModel)]="searchTerm">
      <button class="btn btn-secondary">
        <span class="btn-icon">ğŸ”</span>
        æœç´¢
      </button>
    </div>
    
    <div class="filter-group">
      <select class="filter-select" [(ngModel)]="statusFilter">
        <option value="">æ‰€æœ‰çŠ¶æ€</option>
        <option value="completed">å·²å®Œæˆ</option>
        <option value="in-progress">è¿›è¡Œä¸­</option>
        <option value="failed">å¤±è´¥</option>
        <option value="cancelled">å·²å–æ¶ˆ</option>
      </select>
      
      <select class="filter-select" [(ngModel)]="dateFilter">
        <option value="">æ‰€æœ‰æ—¶é—´</option>
        <option value="today">ä»Šå¤©</option>
        <option value="week">æœ¬å‘¨</option>
        <option value="month">æœ¬æœˆ</option>
        <option value="quarter">æœ¬å­£åº¦</option>
      </select>
    </div>

    <div class="action-group">
      <button class="btn btn-primary" (click)="navigateToDataImport()">
        <span class="btn-icon">â•</span>
        æ–°å»ºæ‰¹æ¬¡
      </button>
      <button class="btn btn-secondary" (click)="refreshBatches()">
        <span class="btn-icon">ğŸ”„</span>
        åˆ·æ–°
      </button>
      <button class="btn btn-secondary" (click)="exportBatches()">
        <span class="btn-icon">ğŸ“¤</span>
        å¯¼å‡ºæŠ¥å‘Š
      </button>
    </div>
  </div>

  <!-- æ‰¹æ¬¡åˆ—è¡¨ -->
  <div class="batch-list">
    <div class="batch-card" *ngFor="let batch of filteredBatches" (click)="viewBatchDetails(batch)">
      <div class="batch-header">
        <div class="batch-title">
          <h3>{{ batch.productModel }} - {{ batch.serialNumber }}</h3>
          <span class="batch-status" [class]="'status-' + batch.status">
            {{ getStatusLabel(batch.status) }}
          </span>
        </div>
        <div class="batch-date">
          {{ batch.createdAt | date:'yyyy-MM-dd HH:mm' }}
        </div>
      </div>
      
      <div class="batch-content">
        <div class="batch-info">
          <div class="info-item">
            <span class="info-label">å®¢æˆ·:</span>
            <span class="info-value">{{ batch.customerName || 'æœªæŒ‡å®š' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">æ“ä½œå‘˜:</span>
            <span class="info-value">{{ batch.operatorName || 'æœªæŒ‡å®š' }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">æµ‹è¯•ç‚¹æ•°:</span>
            <span class="info-value">{{ batch.totalPoints }}</span>
          </div>
          <div class="info-item">
            <span class="info-label">è€—æ—¶:</span>
            <span class="info-value">{{ formatDuration(batch.duration) }}</span>
          </div>
        </div>
        
        <div class="batch-progress">
          <div class="progress-info">
            <span>è¿›åº¦: {{ batch.completedPoints }}/{{ batch.totalPoints }}</span>
            <span class="progress-percentage">{{ getProgressPercentage(batch) }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgressPercentage(batch)"></div>
          </div>
          
          <div class="result-summary">
            <span class="result-item passed">
              <span class="result-icon">âœ…</span>
              {{ batch.passedPoints }}
            </span>
            <span class="result-item failed">
              <span class="result-icon">âŒ</span>
              {{ batch.failedPoints }}
            </span>
            <span class="result-item pending" *ngIf="batch.status === 'in-progress'">
              <span class="result-icon">â³</span>
              {{ batch.totalPoints - batch.completedPoints }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="batch-actions" (click)="$event.stopPropagation()">
        <button class="btn-icon-small" (click)="viewBatchDetails(batch)" title="æŸ¥çœ‹è¯¦æƒ…">
          ğŸ‘ï¸
        </button>
        <button class="btn-icon-small" *ngIf="batch.status === 'in-progress'" 
                (click)="continueBatch(batch)" title="ç»§ç»­æµ‹è¯•">
          â–¶ï¸
        </button>
        <button class="btn-icon-small" (click)="exportBatch(batch)" title="å¯¼å‡ºæŠ¥å‘Š">
          ğŸ“„
        </button>
        <button class="btn-icon-small" (click)="duplicateBatch(batch)" title="å¤åˆ¶æ‰¹æ¬¡">
          ğŸ“‹
        </button>
        <button class="btn-icon-small danger" (click)="deleteBatch(batch)" title="åˆ é™¤æ‰¹æ¬¡">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
  </div>

  <!-- ç©ºçŠ¶æ€ -->
  <div class="empty-state" *ngIf="filteredBatches.length === 0">
    <div class="empty-icon">ğŸ“¦</div>
    <h3>{{ searchTerm || statusFilter || dateFilter ? 'æœªæ‰¾åˆ°åŒ¹é…çš„æ‰¹æ¬¡' : 'æš‚æ— æµ‹è¯•æ‰¹æ¬¡' }}</h3>
    <p>{{ searchTerm || statusFilter || dateFilter ? 'è¯·å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶' : 'ç‚¹å‡»"æ–°å»ºæ‰¹æ¬¡"å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªæµ‹è¯•' }}</p>
    <button class="btn btn-primary" (click)="navigateToDataImport()" *ngIf="!searchTerm && !statusFilter && !dateFilter">
      <span class="btn-icon">â•</span>
      åˆ›å»ºç¬¬ä¸€ä¸ªæ‰¹æ¬¡
    </button>
  </div>

  <!-- åˆ†é¡µ -->
  <div class="pagination" *ngIf="totalPages > 1">
    <button class="btn btn-secondary" [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
      â¬…ï¸ ä¸Šä¸€é¡µ
    </button>
    <span class="page-info">ç¬¬ {{ currentPage }} é¡µï¼Œå…± {{ totalPages }} é¡µ</span>
    <button class="btn btn-secondary" [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
      ä¸‹ä¸€é¡µ â¡ï¸
    </button>
  </div>

  <!-- åŠ è½½çŠ¶æ€ -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>{{ loadingMessage }}</p>
  </div>
</div>
