<div class="host-function-check-container">
  <!-- 页面标题和总体进度 -->
  <nz-card nzTitle="上位机功能检查" [nzExtra]="headerExtraTemplate" class="header-card">
    <ng-template #headerExtraTemplate>
      <nz-space>
        <button *nzSpaceItem nz-button nzType="default" (click)="resetAllChecks()">
          <span nz-icon nzType="reload" nzTheme="outline"></span>
          重置所有
        </button>
        <button *nzSpaceItem nz-button nzType="primary" 
                [disabled]="!isAllCompleted()" 
                (click)="generateReport()">
          <span nz-icon nzType="file-text" nzTheme="outline"></span>
          生成报告
        </button>
      </nz-space>
    </ng-template>

    <!-- 总体进度展示 -->
    <div class="progress-overview">
      <div class="progress-stats">
        <nz-space nzSize="large">
          <div *nzSpaceItem class="stat-item">
            <div class="stat-number">{{ checkItems.length }}</div>
            <div class="stat-label">检查项目</div>
          </div>
          <div *nzSpaceItem class="stat-item success">
            <div class="stat-number">{{ getPassedCount() }}</div>
            <div class="stat-label">检查通过</div>
          </div>
          <div *nzSpaceItem class="stat-item error">
            <div class="stat-number">{{ getFailedCount() }}</div>
            <div class="stat-label">检查失败</div>
          </div>
          <div *nzSpaceItem class="stat-item">
            <div class="stat-number">{{ overallProgress }}%</div>
            <div class="stat-label">完成进度</div>
          </div>
        </nz-space>
      </div>
      
      <div class="progress-bar">
        <nz-progress 
          [nzPercent]="overallProgress" 
          nzStatus="active"
          [nzStrokeColor]="overallProgress === 100 ? '#52c41a' : '#1890ff'">
        </nz-progress>
      </div>
    </div>

    <!-- 整体状态提示 -->
    <div class="status-alert" *ngIf="isAllCompleted()">
      <nz-alert
        [nzType]="getFailedCount() === 0 ? 'success' : 'warning'"
        [nzMessage]="getFailedCount() === 0 ? '所有功能检查已完成，系统功能正常！' : '功能检查已完成，但存在' + getFailedCount() + '项失败，请检查相关功能。'"
        nzShowIcon>
      </nz-alert>
    </div>
  </nz-card>

  <!-- 功能检查项目列表 -->
  <div class="check-items-container">
    <div class="check-items-grid">
      <nz-card 
        *ngFor="let item of checkItems; let i = index"
        class="check-item-card"
        [class.checking]="item.status === 'checking'"
        [class.passed]="item.status === 'passed'"
        [class.failed]="item.status === 'failed'">
        
        <!-- 卡片头部 -->
        <div class="check-item-header">
          <div class="item-icon">
            <span nz-icon [nzType]="item.icon" [style.color]="item.color"></span>
          </div>
          <div class="item-title">
            <h3>{{ item.name }}</h3>
            <nz-tag [nzColor]="getStatusColor(item.status)">
              {{ getStatusText(item.status) }}
            </nz-tag>
          </div>
          <div class="item-actions">
            <nz-space>
              <button *nzSpaceItem 
                      nz-button 
                      nzType="primary" 
                      nzSize="small"
                      [disabled]="isCheckingInProgress && item.status !== 'checking'"
                      (click)="startCheck(item)">
                <span nz-icon nzType="play-circle" nzTheme="outline"></span>
                {{ item.status === 'checking' ? '检查中' : '开始检查' }}
              </button>
              <ng-container *nzSpaceItem>
                <button nz-button
                        nzType="default"
                        nzSize="small"
                        (click)="resetCheck(item)"
                        *ngIf="item.status !== 'pending'">
                  <span nz-icon nzType="reload" nzTheme="outline"></span>
                  重置
                </button>
              </ng-container>
            </nz-space>
          </div>
        </div>

        <!-- 卡片内容 -->
        <div class="check-item-content">
          <p class="item-description">{{ item.description }}</p>
          
          <!-- 检查步骤预览 -->
          <div class="instructions-preview">
            <h4>检查要点：</h4>
            <ul class="instructions-list">
              <li *ngFor="let instruction of item.instructions.slice(0, 3)">
                {{ instruction }}
              </li>
              <li *ngIf="item.instructions.length > 3" class="more-instructions">
                ... 还有 {{ item.instructions.length - 3 }} 个步骤
              </li>
            </ul>
          </div>

          <!-- 检查结果信息 -->
          <div class="check-result" *ngIf="item.checkTime">
            <nz-divider></nz-divider>
            <nz-descriptions nzSize="small" [nzColumn]="1">
              <nz-descriptions-item nzTitle="检查时间">
                {{ item.checkTime | date:'yyyy-MM-dd HH:mm:ss' }}
              </nz-descriptions-item>
              <nz-descriptions-item nzTitle="检查结果" *ngIf="item.status !== 'pending'">
                <nz-tag [nzColor]="getStatusColor(item.status)">
                  {{ getStatusText(item.status) }}
                </nz-tag>
              </nz-descriptions-item>
            </nz-descriptions>
          </div>
        </div>
      </nz-card>
    </div>
  </div>

  <!-- 检查指导说明 -->
  <nz-card nzTitle="检查说明" class="instructions-card">
    <div class="general-instructions">
      <nz-alert
        nzType="info"
        nzMessage="功能检查指导"
        nzDescription="请按照每个检查项目的具体步骤进行操作，确保上位机各项功能正常运行。如遇到问题，请记录具体现象并联系技术支持。"
        nzShowIcon>
      </nz-alert>
      
      <div class="tips-section">
        <h4>检查要点：</h4>
        <ul class="tips-list">
          <li><strong>历史趋势：</strong>重点检查数据完整性和图表显示效果</li>
          <li><strong>实时趋势：</strong>关注数据更新频率和响应速度</li>
          <li><strong>报表功能：</strong>验证报表内容准确性和导出格式</li>
          <li><strong>报警系统：</strong>测试不同级别报警的区分度</li>
          <li><strong>操作日志：</strong>确认日志记录的完整性和准确性</li>
        </ul>
      </div>

      <div class="contact-section">
        <nz-alert
          nzType="warning"
          nzMessage="遇到问题？"
          nzDescription="如果在检查过程中发现任何异常，请及时记录问题现象，并联系系统管理员或技术支持团队。"
          nzShowIcon>
        </nz-alert>
      </div>
    </div>
  </nz-card>
</div>
