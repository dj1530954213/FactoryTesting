<nz-layout class="app-layout">
  <!-- 顶部导航栏 -->
  <nz-header class="app-header">
    <div class="nav-brand">
      <nz-space nzAlign="center">
        <span *nzSpaceItem class="brand-icon">🏭</span>
        <span *nzSpaceItem class="brand-text">工厂验收测试系统</span>
        <nz-tag *nzSpaceItem nzColor="blue">v1.0.0</nz-tag>
      </nz-space>
    </div>
    
    <ul nz-menu nzMode="horizontal" nzTheme="dark" class="nav-menu">
      <li nz-menu-item routerLink="/dashboard" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="dashboard" nzTheme="outline"></span>
        仪表盘
      </li>
      <li nz-menu-item routerLink="/test-plc-config" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="setting" nzTheme="outline"></span>
        测试PLC配置
      </li>
      <li nz-menu-item routerLink="/data-management" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="database" nzTheme="outline"></span>
        数据导入
      </li>
      <li nz-menu-item routerLink="/test-area" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="experiment" nzTheme="outline"></span>
        测试区域
      </li>
      <li nz-menu-item routerLink="/host-function-check" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="check-circle" nzTheme="outline"></span>
        上位机功能检查
      </li>
      <li nz-menu-item routerLink="/result-export" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="export" nzTheme="outline"></span>
        结果导出
      </li>
      <li nz-menu-item routerLink="/system-settings" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="setting" nzTheme="outline"></span>
        系统设置
      </li>
    </ul>
    
    <div class="nav-status">
      <nz-space nzAlign="center">
        <div *nzSpaceItem class="status-item">
          <span class="status-label">系统状态:</span>
          <nz-tag [nzColor]="systemStatus?.system_health === 'healthy' ? 'green' : 'red'">
            {{ systemStatus?.system_health === 'healthy' ? '正常' : '异常' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item">
          <span class="status-label">测试PLC:</span>
          <nz-tag
            [nzColor]="plcConnectionStatus?.testPlcConnected ? 'green' : 'red'"
            [class.blinking]="!plcConnectionStatus?.testPlcConnected"
            [title]="plcConnectionStatus?.testPlcName || '未配置'">
            {{ plcConnectionStatus?.testPlcConnected ? '已连接' : '未连接' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item">
          <span class="status-label">被测PLC:</span>
          <nz-tag
            [nzColor]="plcConnectionStatus?.targetPlcConnected ? 'green' : 'red'"
            [class.blinking]="!plcConnectionStatus?.targetPlcConnected"
            [title]="plcConnectionStatus?.targetPlcName || '未配置'">
            {{ plcConnectionStatus?.targetPlcConnected ? '已连接' : '未连接' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item last-check" [hidden]="!plcConnectionStatus?.lastCheckTime">
          <span class="status-label">最后检查:</span>
          <span class="check-time">{{ plcConnectionStatus?.lastCheckTime | date:'HH:mm:ss' }}</span>
        </div>
      </nz-space>
    </div>
  </nz-header>

  <!-- 主内容区域 -->
  <nz-content class="app-content">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </nz-content>

  <!-- 底部状态栏 -->
  <nz-footer class="app-footer">
    <div class="footer-content">
      <div class="status-left">
        <nz-space nzAlign="center">
          <nz-badge *nzSpaceItem 
                    [nzStatus]="isConnected ? 'success' : 'error'" 
                    [nzText]="isConnected ? '系统运行正常' : '系统连接异常'">
          </nz-badge>
        </nz-space>
      </div>
      
      <div class="status-center">
        <nz-space nzAlign="center">
          <span *nzSpaceItem>活动测试任务: {{ systemStatus?.active_test_tasks || 0 }}</span>
          <nz-divider *nzSpaceItem nzType="vertical"></nz-divider>
          <span *nzSpaceItem>测试进度: {{ getTestProgress() }}%</span>
          <nz-divider *nzSpaceItem nzType="vertical"></nz-divider>
          <span *nzSpaceItem>最后更新: {{ lastUpdateTime | date:'HH:mm:ss' }}</span>
        </nz-space>
      </div>
      
      <div class="status-right">
        <span>工厂验收测试系统 v{{ systemStatus?.version || '1.0.0' }}</span>
      </div>
    </div>
  </nz-footer>
</nz-layout>
