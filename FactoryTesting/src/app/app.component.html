<nz-layout class="app-layout">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <nz-header class="app-header">
    <div class="nav-brand">
      <nz-space nzAlign="center">
        <span *nzSpaceItem class="brand-icon">ğŸ­</span>
        <span *nzSpaceItem class="brand-text">å·¥å‚éªŒæ”¶æµ‹è¯•ç³»ç»Ÿ</span>
        <nz-tag *nzSpaceItem nzColor="blue">v1.0.0</nz-tag>
      </nz-space>
    </div>
    
    <ul nz-menu nzMode="horizontal" nzTheme="dark" class="nav-menu">
      <li nz-menu-item routerLink="/dashboard" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="dashboard" nzTheme="outline"></span>
        ä»ªè¡¨ç›˜
      </li>
      <li nz-menu-item routerLink="/test-plc-config" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="setting" nzTheme="outline"></span>
        æµ‹è¯•PLCé…ç½®
      </li>
      <li nz-menu-item routerLink="/data-management" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="database" nzTheme="outline"></span>
        æ•°æ®å¯¼å…¥
      </li>
      <li nz-menu-item routerLink="/test-area" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="experiment" nzTheme="outline"></span>
        æµ‹è¯•åŒºåŸŸ
      </li>
      <li nz-menu-item routerLink="/host-function-check" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="check-circle" nzTheme="outline"></span>
        ä¸Šä½æœºåŠŸèƒ½æ£€æŸ¥
      </li>
      <li nz-menu-item routerLink="/result-export" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="export" nzTheme="outline"></span>
        ç»“æœå¯¼å‡º
      </li>
      <li nz-menu-item routerLink="/system-settings" routerLinkActive="ant-menu-item-selected">
        <span nz-icon nzType="setting" nzTheme="outline"></span>
        ç³»ç»Ÿè®¾ç½®
      </li>
    </ul>
    
    <div class="nav-status">
      <nz-space nzAlign="center">
        <div *nzSpaceItem class="status-item">
          <span class="status-label">ç³»ç»ŸçŠ¶æ€:</span>
          <nz-tag [nzColor]="systemStatus?.system_health === 'healthy' ? 'green' : 'red'">
            {{ systemStatus?.system_health === 'healthy' ? 'æ­£å¸¸' : 'å¼‚å¸¸' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item">
          <span class="status-label">æµ‹è¯•PLC:</span>
          <nz-tag
            [nzColor]="plcConnectionStatus?.testPlcConnected ? 'green' : 'red'"
            [class.blinking]="!plcConnectionStatus?.testPlcConnected"
            [title]="plcConnectionStatus?.testPlcName || 'æœªé…ç½®'">
            {{ plcConnectionStatus?.testPlcConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item">
          <span class="status-label">è¢«æµ‹PLC:</span>
          <nz-tag
            [nzColor]="plcConnectionStatus?.targetPlcConnected ? 'green' : 'red'"
            [class.blinking]="!plcConnectionStatus?.targetPlcConnected"
            [title]="plcConnectionStatus?.targetPlcName || 'æœªé…ç½®'">
            {{ plcConnectionStatus?.targetPlcConnected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
          </nz-tag>
        </div>
        <div *nzSpaceItem class="status-item last-check" [hidden]="!plcConnectionStatus?.lastCheckTime">
          <span class="status-label">æœ€åæ£€æŸ¥:</span>
          <span class="check-time">{{ plcConnectionStatus?.lastCheckTime | date:'HH:mm:ss' }}</span>
        </div>
      </nz-space>
    </div>
  </nz-header>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <nz-content class="app-content">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </nz-content>

  <!-- åº•éƒ¨çŠ¶æ€æ  -->
  <nz-footer class="app-footer">
    <div class="footer-content">
      <div class="status-left">
        <nz-space nzAlign="center">
          <nz-badge *nzSpaceItem 
                    [nzStatus]="isConnected ? 'success' : 'error'" 
                    [nzText]="isConnected ? 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸' : 'ç³»ç»Ÿè¿æ¥å¼‚å¸¸'">
          </nz-badge>
        </nz-space>
      </div>
      
      <div class="status-center">
        <nz-space nzAlign="center">
          <span *nzSpaceItem>æ´»åŠ¨æµ‹è¯•ä»»åŠ¡: {{ systemStatus?.active_test_tasks || 0 }}</span>
          <nz-divider *nzSpaceItem nzType="vertical"></nz-divider>
          <span *nzSpaceItem>æµ‹è¯•è¿›åº¦: {{ getTestProgress() }}%</span>
          <nz-divider *nzSpaceItem nzType="vertical"></nz-divider>
          <span *nzSpaceItem>æœ€åæ›´æ–°: {{ lastUpdateTime | date:'HH:mm:ss' }}</span>
        </nz-space>
      </div>
      
      <div class="status-right">
        <span>å·¥å‚éªŒæ”¶æµ‹è¯•ç³»ç»Ÿ v{{ systemStatus?.version || '1.0.0' }}</span>
      </div>
    </div>
  </nz-footer>
</nz-layout>
